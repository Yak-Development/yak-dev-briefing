# Yak Dev Daily Briefing & Agent

Automated daily priority briefing pulled from Linear, generated by Claude, delivered to your phone.

**Two ways to run it:**

1. **Standalone Script** — GitHub Actions cron → generates briefing → Apple Shortcut sends it via iMessage (one-way)
2. **Telegram Agent** — Cloudflare Worker → daily briefings via Telegram + two-way conversation to manage your Linear tasks by texting your bot

---

## Option A: Standalone Script (iMessage)

A simple one-way briefing. GitHub Actions runs the script on a cron, writes to a file, and an iPhone Shortcut texts it to you.

### How It Works

1. **GitHub Actions** runs every weekday morning at 7am MST
2. Fetches all active Linear issues from your Yak-Dev workspace
3. Sends them to Claude API which generates a prioritized daily briefing
4. Commits the briefing to `briefing/latest.txt` in this repo
5. **Apple Shortcut** on your iPhone fetches the briefing and sends it to you via iMessage

### Setup

#### 1. Create this repo on GitHub

```bash
cd yak-dev-briefing
git init
git add .
git commit -m "Initial setup"
git branch -M main
git remote add origin https://github.com/YOUR_USERNAME/yak-dev-briefing.git
git push -u origin main
```

#### 2. Get your API keys

**Linear API Key:**
1. Go to https://linear.app/yak-dev/settings/api
2. Click "Create key" → name it "Daily Briefing" → copy the key

**Anthropic API Key:**
1. Go to https://console.anthropic.com/settings/keys
2. Create a new key → copy it

#### 3. Add secrets to GitHub

1. Go to your repo → Settings → Secrets and variables → Actions
2. Add these repository secrets:
   - `LINEAR_API_KEY` → your Linear API key
   - `ANTHROPIC_API_KEY` → your Anthropic API key
   - `LINEAR_TEAM_KEY` → `YAK` (or whatever your team key is)

#### 4. Test the workflow

1. Go to your repo → Actions → "Daily Briefing"
2. Click "Run workflow" → "Run workflow"
3. Wait for it to complete
4. Check `briefing/latest.txt` — you should see your briefing

#### 5. Set up the iPhone Shortcut

**Create the Shortcut:**

1. Open **Shortcuts** on your iPhone
2. Tap **+** → name it "Morning Briefing"
3. Add **Get Contents of URL**:
   - URL: `https://raw.githubusercontent.com/YOUR_USERNAME/yak-dev-briefing/main/briefing/latest.txt`
   - Method: GET
   - (If private repo, add Header: `Authorization` = `token YOUR_GITHUB_PAT`)
4. Add **Send Message**:
   - To: your own phone number
   - Message: output from previous step
5. Tap **Done**

**Automate it:**

1. Shortcuts → Automation → **+** → Time of Day
2. Set to **7:15 AM**, weekdays only
3. Turn OFF "Ask Before Running"
4. Run the "Morning Briefing" shortcut

### Caching

The script caches a hash of your Linear issues. If nothing changed since yesterday, it skips the Anthropic API call and reuses the last briefing. After 3 consecutive days with zero task changes, it replaces the briefing with **"SNAP OUT OF IT, LOCK IN!"**

---

## Option B: Telegram Agent (Two-Way)

A full conversational agent. Gets your daily briefing via Telegram AND lets you manage Linear tasks by texting your bot naturally.

### How It Works

1. **Cloudflare Worker** runs a Telegram bot with a cron trigger
2. Every weekday morning, it generates a briefing and sends it to you via Telegram
3. You can text the bot anytime to update tasks, create issues, add labels, etc.
4. Claude processes your messages and executes the changes in Linear
5. Bot confirms what it did

### What the Agent Can Do

| Action | Example Message |
|--------|----------------|
| Complete tasks | "YAK-42 is done" |
| Change status | "Move YAK-15 to In Progress" |
| Change priority | "Make YAK-20 urgent" |
| Add labels | "Add blocked label to YAK-15" |
| Add comments | "Add a comment to YAK-42: shipped to staging" |
| Create tasks | "Create a task: fix login bug, high priority" |
| Create projects | "Create a new project called Client Portal" |
| Assign work | "Assign YAK-20 to Zach" |
| Get briefing | `/briefing` |

Just text it like you'd text a person. It fuzzy-matches task references — "the auth thing" will match an issue with "auth" in the title.

### Setup

#### 1. Create the Telegram Bot

1. Open Telegram, message **@BotFather**
2. Send `/newbot`, follow the prompts, name it whatever you want
3. Copy the **bot token** it gives you
4. Message **@userinfobot** on Telegram to get your **chat ID**

#### 2. Install dependencies

```bash
cd worker
npm install
```

#### 3. Create the KV namespace

```bash
npx wrangler kv namespace create KV
```

Copy the `id` from the output and paste it into `worker/wrangler.toml` under `[[kv_namespaces]]`.

#### 4. Set your secrets

```bash
npx wrangler secret put TELEGRAM_BOT_TOKEN
npx wrangler secret put TELEGRAM_CHAT_ID
npx wrangler secret put ANTHROPIC_API_KEY
npx wrangler secret put LINEAR_API_KEY
npx wrangler secret put WEBHOOK_SECRET
```

- `TELEGRAM_BOT_TOKEN` — from BotFather
- `TELEGRAM_CHAT_ID` — from @userinfobot
- `ANTHROPIC_API_KEY` — from console.anthropic.com
- `LINEAR_API_KEY` — from linear.app settings
- `WEBHOOK_SECRET` — any random string you make up (used to verify Telegram calls)

#### 5. Deploy

```bash
npx wrangler deploy
```

Note the URL it prints (e.g. `https://yak-dev-agent.YOUR_SUBDOMAIN.workers.dev`).

#### 6. Register the Telegram webhook

```bash
curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook?url=https://yak-dev-agent.<YOUR_SUBDOMAIN>.workers.dev/webhook&secret_token=<YOUR_WEBHOOK_SECRET>"
```

#### 7. Test it

Open your bot in Telegram and send `/start`. It should respond. Then try:
- `/briefing` — get your daily briefing on demand
- `/help` — see available commands
- Or just text it: "What's on my plate?"

### Bot Commands

| Command | What it does |
|---------|-------------|
| `/start` | Welcome message + your chat ID |
| `/briefing` | Generate and send your daily briefing now |
| `/clear` | Reset conversation history |
| `/help` | Show available commands |

### Configuration

Edit `worker/wrangler.toml` to change:
- **Cron schedule** — default is `0 13 * * 1-5` (1pm UTC / 8am EST, weekdays)
- **Team key** — default is `YAK`
- **Claude model** — default is `claude-opus-4-6`

### Caching

Same logic as the standalone script — briefings are cached in Cloudflare KV. If your Linear tasks haven't changed, it skips the Anthropic call. After 3 unchanged days: **"SNAP OUT OF IT, LOCK IN!"**

---

## Project Structure

```
yak-dev-briefing/
├── scripts/
│   └── daily-briefing.js    ← Standalone script (Option A)
├── briefing/
│   ├── latest.txt            ← Most recent briefing output
│   ├── archive/              ← Timestamped history
│   └── cache.json            ← Issue hash cache (gitignored)
├── worker/                   ← Telegram agent (Option B)
│   ├── src/
│   │   ├── index.js          ← Worker entry: webhook + cron
│   │   ├── agent.js          ← Claude tool-use loop
│   │   ├── tools.js          ← 7 Linear tools + handlers
│   │   ├── linear.js         ← Linear GraphQL API layer
│   │   ├── telegram.js       ← Telegram API helpers
│   │   └── briefing.js       ← Daily briefing with KV cache
│   ├── wrangler.toml         ← Cloudflare Worker config
│   └── package.json
└── package.json
```

## Costs

- **GitHub Actions** (Option A): Free
- **Cloudflare Workers** (Option B): Free tier covers it (100k requests/day, cron triggers included)
- **Claude API**: ~$0.01–0.05 per interaction
- **Linear API**: Free
- **Telegram Bot API**: Free
